<?php// Change caching settings for debugging/production as needed// define ("CACHE_LIFETIME", 0); if (class_exists('Extension_TicketToolbarItem',true)):	class ZabrusExtendedPrintTicketToolbar extends Extension_TicketToolbarItem {		function render(Model_Ticket $ticket) {			$tpl->cache_lifetime = CACHE_LIFETIME;			$tpl = DevblocksPlatform::getTemplateService();			$tpl->assign('ticket', $ticket); /* @var $ticket Model_Ticket */			$tpl->display('devblocks:zabrus.extendedprint::ticket_toolbar_extendedprint.tpl');		}	};endif;class ZabrusExtendedPrintSettings {	const GLOBAL_SETTINGS = 'global_settings';	const HIDE_MESSAGES = 'hide_messages';	const SHOW_QUOTES = 'show_quotes';	const OPEN_PRINT_DIALOG = 'open_print_dialog';	const CUSTOM_STYLES = 'custom_styles';	const CUSTOM_STYLE_SHEET = 'custom_style_sheet'; 	const USE_PERSONAL_SETTINGS = 'use_personal_settings';	const PERSONAL_PRINT_SETTINGS = true;	const GLOBAL_PRINT_SETTINGS = false;		static function getSettingsKey ($personal) {		$worker = CerberusApplication::getActiveWorker();		return 'zabrus.extendedprint.' . ((empty($worker) || !$personal) ? 'global' : $worker->id);	}	public static function getSettings ($personal) {		$settings = DevblocksPlatform::getPluginSettingsService();		$postfix = self::getSettingsKey($personal);		return array (			self::USE_PERSONAL_SETTINGS	=> $settings->get ($postfix, self::USE_PERSONAL_SETTINGS , false),			self::HIDE_MESSAGES			=> $settings->get ($postfix, self::HIDE_MESSAGES , false),			self::SHOW_QUOTES			=> $settings->get ($postfix, self::SHOW_QUOTES , false),			self::OPEN_PRINT_DIALOG		=> $settings->get ($postfix, self::OPEN_PRINT_DIALOG , false),			self::CUSTOM_STYLES			=> $settings->get ($postfix, self::CUSTOM_STYLES , false),			self::CUSTOM_STYLE_SHEET	=> $settings->get ($postfix, self::CUSTOM_STYLE_SHEET , false)		);	}		public static function saveSetting ($key, $value, $personal) {		$settings = DevblocksPlatform::getPluginSettingsService();		$postfix = self::getSettingsKey($personal);		$settings->set ($postfix, $key, $value);	}}class ZabrusExtendedPrintConfigTab extends Extension_ConfigTab {	const ID = 'zabrus.extendedprint.config.tab';	function showTab() {		$tpl = DevblocksPlatform::getTemplateService();		$tpl->cache_lifetime = CACHE_LIFETIME;				$tpl->assign ('personal_print_settings', ZabrusExtendedPrintSettings::getSettings (true));		$tpl->assign ('global_print_settings',   ZabrusExtendedPrintSettings::getSettings (false));		$tpl->display('devblocks:zabrus.extendedprint::print_config.tpl');	}	function saveTab () {		@$personal = !(DevblocksPlatform::importGPC($_REQUEST[ZabrusExtendedPrintSettings::GLOBAL_SETTINGS], 'string','') == 'yes');				if ($personal) {			@$use_personal_settings = DevblocksPlatform::importGPC($_REQUEST[ZabrusExtendedPrintSettings::USE_PERSONAL_SETTINGS], 'string','');		}		@$hide_messages = DevblocksPlatform::importGPC($_REQUEST[ZabrusExtendedPrintSettings::HIDE_MESSAGES], 'string','');		@$show_quotes = DevblocksPlatform::importGPC($_REQUEST[ZabrusExtendedPrintSettings::SHOW_QUOTES], 'string','');		@$open_print_dialog = DevblocksPlatform::importGPC($_REQUEST[ZabrusExtendedPrintSettings::OPEN_PRINT_DIALOG], 'string','');		@$custom_styles = DevblocksPlatform::importGPC($_REQUEST[ZabrusExtendedPrintSettings::CUSTOM_STYLES], 'string','');		@$custom_style_sheet = DevblocksPlatform::importGPC($_REQUEST[ZabrusExtendedPrintSettings::CUSTOM_STYLE_SHEET], 'string','');		if ($personal) {			ZabrusExtendedPrintSettings::saveSetting (ZabrusExtendedPrintSettings::USE_PERSONAL_SETTINGS, $use_personal_settings == 'yes', $personal);		}			ZabrusExtendedPrintSettings::saveSetting (ZabrusExtendedPrintSettings::HIDE_MESSAGES, $hide_messages == 'yes', $personal);		ZabrusExtendedPrintSettings::saveSetting (ZabrusExtendedPrintSettings::SHOW_QUOTES, $show_quotes == 'yes', $personal);		ZabrusExtendedPrintSettings::saveSetting (ZabrusExtendedPrintSettings::OPEN_PRINT_DIALOG, $open_print_dialog == 'yes', $personal);		ZabrusExtendedPrintSettings::saveSetting (ZabrusExtendedPrintSettings::CUSTOM_STYLES, $custom_styles == 'yes', $personal);		ZabrusExtendedPrintSettings::saveSetting (ZabrusExtendedPrintSettings::CUSTOM_STYLE_SHEET, $custom_style_sheet, $personal);				DevblocksPlatform::redirect(new DevblocksHttpResponse(array('config','extendedprint')));		exit;	}	};?>